# description	: boost
# maintainer	: iagapie, igoragapie at gmail.com
# depends	    : gcc zlib bzip2 which icu python2 python3

name=boost
version=1.72.0
release=1
source="https://dl.bintray.com/boostorg/release/$version/source/boost_${version//./_}.tar.bz2"

build() {
	cd boost_${version//./_}

	./bootstrap.sh --prefix=/usr
	./b2 ${MAKEFLAGS} stage --stagedir=$PKG/usr threading=multi link=shared
	./b2 ${MAKEFLAGS} -q install --prefix=$PKG/usr threading=multi link=shared

	sed -e '/using python/ s@;@: /usr/include/python${PYTHON_VERSION/3*/${PYTHON_VERSION}m} ;@' \
	      -i bootstrap.sh

	./bootstrap.sh --prefix=/usr --with-python=/usr/bin/python3
	./b2 clean

	export CPLUS_INCLUDE_PATH="$CPLUS_INCLUDE_PATH:/usr/include/python3.8/"
	
	./b2 ${MAKEFLAGS} -q install --prefix=$SRC/py3 threading=multi link=shared
	cp -a $SRC/py3/lib/libboost_* $PKG/usr/lib

	# https://github.com/boostorg/python/issues/203#issuecomment-391477685
	for _lib in python numpy; do
		ln -srL $PKG/usr/lib/libboost_${_lib}{27,}.so
		ln -srL $PKG/usr/lib/libboost_${_lib}3{7,}.so
	done

	ln -sv detail/sha1.hpp $PKG/usr/include/boost/uuid/sha1.hpp

	unset CPLUS_INCLUDE_PATH
}
