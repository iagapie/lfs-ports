# Description:
# URL:
# Maintainer:
# Depends on:

name=docker
version=19.03.5
release=1
source=(https://download.docker.com/linux/static/stable/x86_64/docker-$version.tgz)

build() {
	cd $name

	mkdir -p $PKG/usr/bin

	cp -r ./* $PKG/usr/bin/

	install -d -m755 $PKG/lib/systemd/system/	
	cat > $PKG/lib/systemd/system/docker.service << "EOF"
[Unit]
Description=Docker Application Container Engine
Documentation=https://docs.docker.com
After=network.target

[Service]
Type=notify
# the default is not to use systemd for cgroups because the delegate issues still
# exists and systemd currently does not support the cgroup feature set required
# for containers run by docker
ExecStart=/usr/bin/dockerd
ExecReload=/bin/kill -s HUP $MAINPID
# Having non-zero Limit*s causes performance problems due to accounting overhead
# in the kernel. We recommend using cgroups to do container-local accounting.
LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity
TasksMax=infinity
TimeoutStartSec=0
# set delegate yes so that systemd does not reset the cgroups of docker containers
Delegate=yes
# kill only the docker process, not all processes in the cgroup
KillMode=process

[Install]
WantedBy=multi-user.target
EOF

	chmod 644 $PKG/lib/systemd/system/docker.service
}
